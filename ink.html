<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0" name="viewport">
  <meta content="yes" name="apple-mobile-web-app-capable">
  <meta content="yes" name="apple-touch-fullscreen">
  <meta content="black" name="apple-mobile-web-app-status-bar-style">
  <meta content="320" name="MobileOptimized">
  <meta content="true" name="HandheldFriendly">
  <meta name="mobile-web-app-capable" content="yes">

  <title>生88课</title>

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: #000;
      color: white;
      overflow: hidden;
      position: fixed;
      width: 100%;
      height: 100%;
    }
    
    .container {
      width: 100px;
      height: 100px;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 100;
    }

    .dot {
      width: 15px;
      height: 15px;
      border-radius: 50%;
      background-color: #000;
      position: absolute;
      top: 0;
      bottom: 0;
      left: 0;
      right: 0;
      margin: auto;
    }

    .dot-3 {
      background-color: #f74d75;
      animation: dot-3-move 2s ease infinite;
    }

    @keyframes dot-3-move {
      20% { transform: scale(1) }
      45% { transform: translateY(-18px) scale(.45) }
      60% { transform: translateY(-25px) scale(.45) }
      80% { transform: translateY(-25px) scale(.45) }
      100% { transform: translateY(0px) scale(1) }
    }

    .dot-2 {
      background-color: #10beae;
      animation: dot-2-move 2s ease infinite;
    }

    .dot-1 {
      background-color: #ffe386;
      animation: dot-1-move 2s ease infinite;
    }

    @keyframes dot-2-move {
      20% { transform: scale(1) }
      45% { transform: translate(-16px, 12px) scale(.45) }
      60% { transform: translate(-20px, 15px) scale(.45) }
      80% { transform: translate(-20px, 15px) scale(.45) }
      100% { transform: translateY(0px) scale(1) }
    }

    @keyframes dot-1-move {
      20% { transform: scale(1) }
      45% { transform: translate(16px, 12px) scale(.45) }
      60% { transform: translate(20px, 15px) scale(.45) }
      80% { transform: translate(20px, 15px) scale(.45) }
      100% { transform: translateY(0px) scale(1) }
    }

    .container {
      animation: rotate-move 2s ease-in-out infinite;
    }

    @keyframes rotate-move {
      55% { transform: translate(-50%, -50%) rotate(0deg) }
      80% { transform: translate(-50%, -50%) rotate(360deg) }
      100% { transform: translate(-50%, -50%) rotate(360deg) }
    }
    
    .content {
      height: 100%;
      width: 100%;
      position: fixed;
      left: 0;
      top: 0;
      border: none;
      background: #000;
      -webkit-overflow-scrolling: touch;
      overflow: auto;
      z-index: 2;
    }
    
    /* 自定义全屏按钮 */
    .fullscreen-button {
      position: fixed;
      right: 20px;
      bottom: 20px;
      z-index: 9999;
      background: rgba(0, 0, 0, 0.7);
      color: white;
      border: 1px solid rgba(255, 255, 255, 0.5);
      border-radius: 20px;
      padding: 12px 20px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      display: none;
      transition: all 0.3s ease;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
    }
    
    .fullscreen-button:hover {
      background: rgba(0, 0, 0, 0.9);
      transform: scale(1.05);
    }
    
    /* 控制面板 */
    .control-panel {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background: linear-gradient(to top, rgba(0,0,0,0.8), transparent);
      padding: 15px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 9998;
      display: none;
    }
    
    .progress-container {
      flex-grow: 1;
      height: 4px;
      background: rgba(255, 255, 255, 0.3);
      border-radius: 2px;
      margin: 0 15px;
      cursor: pointer;
      position: relative;
    }
    
    .progress-bar {
      height: 100%;
      background: #f74d75;
      border-radius: 2px;
      width: 0%;
    }
    
    .time-display {
      font-size: 14px;
      color: #ddd;
      min-width: 100px;
      text-align: center;
    }
    
    .control-btn {
      background: none;
      border: none;
      color: white;
      font-size: 18px;
      cursor: pointer;
      padding: 5px 10px;
    }
    
    /* 错误提示 */
    .error-message {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0, 0, 0, 0.8);
      padding: 20px;
      border-radius: 10px;
      text-align: center;
      z-index: 10000;
      display: none;
    }
    
    .error-message button {
      margin-top: 15px;
      padding: 8px 15px;
      background: #f74d75;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    
    /* 模式选择器 */
    .mode-selector {
      position: fixed;
      right: 20px;
      bottom: 70px;
      background: rgba(0, 0, 0, 0.7);
      border-radius: 10px;
      padding: 10px;
      z-index: 9997;
      display: none;
      flex-direction: column;
    }
    
    .mode-btn {
      background: rgba(255, 255, 255, 0.1);
      border: none;
      color: white;
      padding: 8px 12px;
      margin: 5px 0;
      border-radius: 5px;
      cursor: pointer;
      text-align: left;
    }
    
    .mode-btn.active {
      background: rgba(247, 77, 117, 0.5);
    }
    
    /* 加载提示 */
    .loading-text {
      position: fixed;
      top: 60%;
      left: 0;
      width: 100%;
      text-align: center;
      color: #aaa;
      font-size: 14px;
      z-index: 101;
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="dot dot-1"></div>
    <div class="dot dot-2"></div>
    <div class="dot dot-3"></div>
  </div>
  <div class="loading-text">正在加载视频内容，请稍候...</div>
  
  <button class="fullscreen-button" id="fullscreenBtn">全屏播放</button>
  
  <div class="mode-selector" id="modeSelector">
    <button class="mode-btn active" data-mode="iframe">网页模式（兼容）</button>
    <button class="mode-btn" data-mode="direct">直接播放（纯净）</button>
  </div>
  
  <div class="control-panel" id="controlPanel">
    <button class="control-btn" id="playPauseBtn">⏸️</button>
    <div class="progress-container" id="progressContainer">
      <div class="progress-bar" id="progressBar"></div>
    </div>
    <div class="time-display" id="timeDisplay">00:00 / 00:00</div>
    <button class="control-btn" id="soundBtn">🔊</button>
  </div>
  
  <div class="error-message" id="errorMessage">
    <p>视频加载失败，请尝试切换播放模式</p>
    <button id="retryBtn">重试</button>
  </div>

  <script>
    // 获取URL参数
    var urlParams = new URLSearchParams(window.location.search);
    var encodedParam = urlParams.get('c');
    var trueurl = encodedParam ? atob(encodedParam) : '';
    
    // 获取DOM元素
    var fullscreenBtn = document.getElementById('fullscreenBtn');
    var modeSelector = document.getElementById('modeSelector');
    var controlPanel = document.getElementById('controlPanel');
    var errorMessage = document.getElementById('errorMessage');
    var retryBtn = document.getElementById('retryBtn');
    var playPauseBtn = document.getElementById('playPauseBtn');
    var progressContainer = document.getElementById('progressContainer');
    var progressBar = document.getElementById('progressBar');
    var timeDisplay = document.getElementById('timeDisplay');
    var soundBtn = document.getElementById('soundBtn');
    
    // 全局变量
    var currentMode = 'iframe';
    var videoElement = null;
    var isPlaying = false;
    var isFullscreen = false;
    
    // 初始化
    document.addEventListener('DOMContentLoaded', function() {
      if (trueurl && trueurl.includes("http")) {
        initPlayer();
      } else {
        showError("无效的视频链接参数");
      }
    });
    
    // 初始化播放器
    function initPlayer() {
      // 隐藏加载动画
      setTimeout(function() {
        document.querySelector(".container").style.display = "none";
        document.querySelector(".loading-text").style.display = "none";
      }, 1500);
      
      // 创建iframe
      createIframePlayer();
      
      // 显示全屏按钮
      setTimeout(function() {
        fullscreenBtn.style.display = 'block';
      }, 2000);
      
      // 事件监听
      fullscreenBtn.addEventListener('click', toggleFullscreen);
      retryBtn.addEventListener('click', retryPlayback);
      
      // 添加模式选择按钮事件
      var modeButtons = document.querySelectorAll('.mode-btn');
      modeButtons.forEach(function(btn) {
        btn.addEventListener('click', function() {
          modeButtons.forEach(b => b.classList.remove('active'));
          this.classList.add('active');
          switchMode(this.dataset.mode);
        });
      });
      
      // 添加控制面板事件
      playPauseBtn.addEventListener('click', togglePlayPause);
      progressContainer.addEventListener('click', seekVideo);
      soundBtn.addEventListener('click', toggleMute);
    }
    
    // 创建iframe播放器
    function createIframePlayer() {
      var iframe = document.createElement('iframe');
      iframe.className = 'content';
      iframe.id = 'videoIframe';
      iframe.setAttribute('allowfullscreen', '');
      iframe.setAttribute('webkitallowfullscreen', '');
      iframe.setAttribute('mozallowfullscreen', '');
      iframe.setAttribute('allow', 'autoplay; fullscreen; accelerometer; gyroscope; encrypted-media; picture-in-picture');
      iframe.setAttribute('frameborder', '0');
      iframe.setAttribute('scrolling', 'no');
      
      iframe.onload = function() {
        try {
          // 尝试注入CSS来隐藏不需要的元素
          injectIframeStyles(iframe);
        } catch(e) {
          console.log('无法注入样式:', e);
        }
      };
      
      iframe.onerror = function() {
        showError("iframe加载失败");
      };
      
      iframe.src = trueurl;
      document.body.appendChild(iframe);
    }
    
    // 创建直接视频播放器
    function createDirectVideoPlayer() {
      // 先移除iframe
      var iframe = document.getElementById('videoIframe');
      if (iframe) iframe.remove();
      
      // 创建video元素
      videoElement = document.createElement('video');
      videoElement.id = 'directVideo';
      videoElement.className = 'content';
      videoElement.controls = false;
      videoElement.autoplay = true;
      videoElement.playsInline = true;
      
      // 添加源
      var source = document.createElement('source');
      source.src = trueurl;
      source.type = 'video/mp4';
      videoElement.appendChild(source);
      
      // 添加事件
      videoElement.addEventListener('loadedmetadata', function() {
        updateTimeDisplay();
      });
      
      videoElement.addEventListener('timeupdate', function() {
        updateProgress();
      });
      
      videoElement.addEventListener('play', function() {
        isPlaying = true;
        playPauseBtn.textContent = '⏸️';
      });
      
      videoElement.addEventListener('pause', function() {
        isPlaying = false;
        playPauseBtn.textContent = '▶️';
      });
      
      videoElement.addEventListener('error', function() {
        showError("视频加载失败，请使用网页模式");
      });
      
      videoElement.addEventListener('click', function() {
        controlPanel.style.display = 'flex';
        setTimeout(function() {
          if (isPlaying) controlPanel.style.display = 'none';
        }, 3000);
      });
      
      document.body.appendChild(videoElement);
      
      // 显示控制面板
      controlPanel.style.display = 'flex';
    }
    
    // 切换播放模式
    function switchMode(mode) {
      if (mode === currentMode) return;
      
      currentMode = mode;
      
      if (mode === 'direct') {
        createDirectVideoPlayer();
      } else {
        createIframePlayer();
        controlPanel.style.display = 'none';
      }
    }
    
    // 注入iframe样式
    function injectIframeStyles(iframe) {
      try {
        var style = document.createElement('style');
        style.textContent = `
          body > *:not(.content):not(script):not(style) {
            display: none !important;
            visibility: hidden !important;
          }
          body, html {
            overflow: hidden !important;
            background: #000 !important;
            width: 100% !important;
            height: 100% !important;
          }
          video {
            object-fit: contain !important;
            width: 100% !important;
            height: 100% !important;
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            z-index: 9999 !important;
          }
        `;
        
        iframe.contentDocument.head.appendChild(style);
      } catch(e) {
        console.log('样式注入失败:', e);
      }
    }
    
    // 切换全屏
    function toggleFullscreen() {
      if (!isFullscreen) {
        // 进入全屏
        var elem = document.documentElement;
        
        if (elem.requestFullscreen) {
          elem.requestFullscreen();
        } else if (elem.webkitRequestFullscreen) {
          elem.webkitRequestFullscreen();
        } else if (elem.msRequestFullscreen) {
          elem.msRequestFullscreen();
        }
        
        fullscreenBtn.textContent = '退出全屏';
        modeSelector.style.display = 'flex';
        
        // 横屏提示
        if (window.screen.orientation && window.screen.orientation.lock) {
          window.screen.orientation.lock('landscape').catch(function(error) {
            console.log('横屏锁定失败:', error);
          });
        }
      } else {
        // 退出全屏
        if (document.exitFullscreen) {
          document.exitFullscreen();
        } else if (document.webkitExitFullscreen) {
          document.webkitExitFullscreen();
        } else if (document.msExitFullscreen) {
          document.msExitFullscreen();
        }
        
        fullscreenBtn.textContent = '全屏播放';
        modeSelector.style.display = 'none';
        
        // 竖屏提示
        if (window.screen.orientation && window.screen.orientation.unlock) {
          window.screen.orientation.unlock();
        }
      }
      
      isFullscreen = !isFullscreen;
    }
    
    // 切换播放/暂停
    function togglePlayPause() {
      if (currentMode === 'direct' && videoElement) {
        if (videoElement.paused) {
          videoElement.play();
          playPauseBtn.textContent = '⏸️';
        } else {
          videoElement.pause();
          playPauseBtn.textContent = '▶️';
        }
      }
    }
    
    // 视频跳转
    function seekVideo(e) {
      if (currentMode === 'direct' && videoElement) {
        var percent = e.offsetX / progressContainer.offsetWidth;
        videoElement.currentTime = percent * videoElement.duration;
        updateProgress();
      }
    }
    
    // 切换静音
    function toggleMute() {
      if (currentMode === 'direct' && videoElement) {
        videoElement.muted = !videoElement.muted;
        soundBtn.textContent = videoElement.muted ? '🔇' : '🔊';
      }
    }
    
    // 更新进度条
    function updateProgress() {
      if (currentMode === 'direct' && videoElement) {
        var value = (videoElement.currentTime / videoElement.duration) * 100;
        progressBar.style.width = value + '%';
        updateTimeDisplay();
      }
    }
    
    // 更新时间显示
    function updateTimeDisplay() {
      if (currentMode === 'direct' && videoElement) {
        var currentTime = formatTime(videoElement.currentTime);
        var duration = formatTime(videoElement.duration);
        timeDisplay.textContent = currentTime + ' / ' + duration;
      }
    }
    
    // 格式化时间
    function formatTime(seconds) {
      var min = Math.floor(seconds / 60);
      var sec = Math.floor(seconds % 60);
      return min.toString().padStart(2, '0') + ':' + sec.toString().padStart(2, '0');
    }
    
    // 显示错误信息
    function showError(message) {
      errorMessage.querySelector('p').textContent = message;
      errorMessage.style.display = 'block';
    }
    
    // 重试播放
    function retryPlayback() {
      errorMessage.style.display = 'none';
      if (currentMode === 'direct') {
        createDirectVideoPlayer();
      } else {
        createIframePlayer();
      }
    }
    
    // 监听全屏变化
    document.addEventListener('fullscreenchange', handleFullscreenChange);
    document.addEventListener('webkitfullscreenchange', handleFullscreenChange);
    document.addEventListener('mozfullscreenchange', handleFullscreenChange);
    document.addEventListener('MSFullscreenChange', handleFullscreenChange);
    
    function handleFullscreenChange() {
      isFullscreen = !!(document.fullscreenElement || document.webkitFullscreenElement || 
                        document.mozFullScreenElement || document.msFullscreenElement);
      
      fullscreenBtn.textContent = isFullscreen ? '退出全屏' : '全屏播放';
      modeSelector.style.display = isFullscreen ? 'flex' : 'none';
    }
  </script>
</body>
</html>
