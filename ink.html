<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0" name="viewport">
  <meta content="yes" name="apple-mobile-web-app-capable">
  <meta content="yes" name="apple-touch-fullscreen">
  <meta content="black" name="apple-mobile-web-app-status-bar-style">
  <meta content="320" name="MobileOptimized">
  <meta content="true" name="HandheldFriendly">
  <meta name="mobile-web-app-capable" content="yes">

  <!-- Open Graph 协议标签 - 微信分享卡片用 -->
  <meta property="og:title" content="生命密码" />
  <meta property="og:description" content="邀请您一起来学习" />
  <meta property="og:image" content="https://m.360buyimg.com/i/jfs/t1/307252/25/16806/3963/68751929Fe9835238/cd51d524746c2785.jpg" />
  <meta property="og:type" content="website" />
  <meta property="og:url" id="og-url" content="" />
  <meta property="og:site_name" content="生命密码" />

  <!-- 微信特定标签（可选） -->
  <meta property="wechat:miniprogram" content="" />
  <meta property="wechat:miniprogram_image" content="" />

  <title>生命密码 曾老师学习课</title>

  <style>
    .container {
      width: 100px;
      height: 100px;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }

    .dot {
      width: 15px;
      height: 15px;
      border-radius: 50%;
      background-color: #000;
      position: absolute;
      top: 0;
      bottom: 0;
      left: 0;
      right: 0;
      margin: auto;
    }

    .dot-3 {
      background-color: #f74d75;
      animation: dot-3-move 2s ease infinite;
    }

    @keyframes dot-3-move {
      20% { transform: scale(1) }
      45% { transform: translateY(-18px) scale(.45) }
      60% { transform: translateY(-25px) scale(.45) }
      80% { transform: translateY(-25px) scale(.45) }
      100% { transform: translateY(0px) scale(1) }
    }

    .dot-2 {
      background-color: #10beae;
      animation: dot-2-move 2s ease infinite;
    }

    .dot-1 {
      background-color: #ffe386;
      animation: dot-1-move 2s ease infinite;
    }

    @keyframes dot-2-move {
      20% { transform: scale(1) }
      45% { transform: translate(-16px, 12px) scale(.45) }
      60% { transform: translate(-20px, 15px) scale(.45) }
      80% { transform: translate(-20px, 15px) scale(.45) }
      100% { transform: translateY(0px) scale(1) }
    }

    @keyframes dot-1-move {
      20% { transform: scale(1) }
      45% { transform: translate(16px, 12px) scale(.45) }
      60% { transform: translate(20px, 15px) scale(.45) }
      80% { transform: translate(20px, 15px) scale(.45) }
      100% { transform: translateY(0px) scale(1) }
    }

    .container {
      animation: rotate-move 2s ease-in-out infinite;
    }

    @keyframes rotate-move {
      55% { transform: translate(-50%, -50%) rotate(0deg) }
      80% { transform: translate(-50%, -50%) rotate(360deg) }
      100% { transform: translate(-50%, -50%) rotate(360deg) }
    }
    
    .content {
      height:100%;
      width:100%;
      position: fixed;
      left: 0;
      top: 0;
      border: none;
      background: #000;
      -webkit-overflow-scrolling: touch;
      overflow: auto;
    }
    
    /* 全屏相关样式 */
    :-webkit-full-screen .content {
      width: 100% !important;
      height: 100% !important;
    }
    
    :-moz-full-screen .content {
      width: 100% !important;
      height: 100% !important;
    }
    
    :-ms-fullscreen .content {
      width: 100% !important;
      height: 100% !important;
    }
    
    :fullscreen .content {
      width: 100% !important;
      height: 100% !important;
    }
    
    /* 隐藏视频播放器的倍速控制 */
    video::-webkit-media-controls-playback-rate-button {
      display: none !important;
    }
  </style>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      document.getElementById('og-url').content = window.location.href;
    });
  </script>
</head>

<body>
  <div class="container">
    <div class="dot dot-1"></div>
    <div class="dot dot-2"></div>
    <div class="dot dot-3"></div>
  </div>

  <script>
    var urlParams = new URLSearchParams(window.location.search);
    var encodedParam = urlParams.get('c');
    var tureurl = atob(encodedParam);
    
    // 检查是否是特定域名，如果是则直接跳转
    function shouldRedirect(url) {
      if(!url) return false;
      
      try {
        const urlObj = new URL(url);
        // 匹配81388c.wx.sdjstudy.cn域名
        if(urlObj.hostname.includes('81388c.wx.sdjstudy.cn')) {
          return true;
        }
        // 匹配所有weixin.qq.com子域名
        if(urlObj.hostname.endsWith('weixin.qq.com')) {
          return true;
        }
      } catch(e) {
        console.log('URL解析错误:', e);
      }
      return false;
    }
    
    // 检查是否需要跳出iframe
    function shouldBreakOut(url) {
      if(!url) return false;
      
      try {
        const currentUrlObj = new URL(iframe.src);
        const newUrlObj = new URL(url, currentUrlObj.origin);
        
        // 如果跨域或不是当前页面，则需要跳出
        return newUrlObj.origin !== currentUrlObj.origin;
      } catch(e) {
        console.log('URL解析错误:', e);
        return true;
      }
    }
    
    if (tureurl && tureurl.includes("http")) {
      if (shouldRedirect(tureurl)) {
        // 直接跳转
        window.location.href = tureurl;
      } else {
        // 正常iframe加载
        var square = document.querySelector(".container");
        setTimeout(function() {
          square.style.display = "none";
        }, 1500);
        
        var iframe = document.createElement('iframe');
        iframe.className = 'content';
        iframe.setAttribute('allowfullscreen', '');
        iframe.setAttribute('webkitallowfullscreen', '');
        iframe.setAttribute('mozallowfullscreen', '');
        iframe.setAttribute('allow', 'autoplay; fullscreen; accelerometer; gyroscope');
        iframe.setAttribute('scrolling', 'no');
        iframe.setAttribute('frameborder', '0');
        
        // 监听iframe内部跳转
        var lastIframeUrl = tureurl;
        var checkUrlInterval = setInterval(function() {
          try {
            var currentUrl = iframe.contentWindow.location.href;
            if(currentUrl !== lastIframeUrl) {
              lastIframeUrl = currentUrl;
              if(shouldBreakOut(currentUrl)) {
                window.location.href = currentUrl;
                clearInterval(checkUrlInterval);
              }
            }
          } catch(e) {
            // 跨域错误，无法检查URL变化
          }
        }, 300);
        
        // 监听iframe内的点击事件（通过冒泡）
        window.addEventListener('click', function(e) {
          if(e.target.tagName === 'A' && e.target.href) {
            if(shouldBreakOut(e.target.href)) {
              e.preventDefault();
              window.location.href = e.target.href;
            }
          }
        });
        
        // 监听postMessage消息（iframe内部可能通过这种方式通知跳转）
        window.addEventListener('message', function(event) {
          if(event.data && event.data.type === 'redirect' && event.data.url) {
            window.location.href = event.data.url;
          }
        });
        
        // 更强大的样式注入方案
        iframe.onload = function() {
          try {
            // 主样式注入
            var style = document.createElement('style');
            style.textContent = `
              /* 隐藏所有非视频元素 */
              body *:not(video):not(iframe):not(object):not(embed) {
                display: none !important;
                visibility: hidden !important;
                height: 0 !important;
                width: 0 !important;
                opacity: 0 !important;
                padding: 0 !important;
                margin: 0 !important;
                position: absolute !important;
                clip: rect(0 0 0 0) !important;
                overflow: hidden !important;
              }
              
              /* 确保视频全屏 */
              video, iframe, object, embed {
                position: fixed !important;
                top: 0 !important;
                left: 0 !important;
                width: 100% !important;
                height: 100% !important;
                z-index: 999999 !important;
              }
              
              /* 重置body和html */
              body, html {
                padding: 0 !important;
                margin: 0 !important;
                overflow: hidden !important;
                background: black !important;
                height: 100% !important;
                width: 100% !important;
              }
              
              /* 隐藏播放器控制条中的倍速按钮 */
              .vjs-playback-rate, 
              [class*="speed-control"], 
              [class*="rate-control"],
              .plyr__menu__container [data-plyr="speed"],
              [data-testid="player-controls"] [aria-label*="speed"],
              [aria-label*="playback rate"] {
                display: none !important;
              }
              
              /* 隐藏广告和叠加层 */
              .ad-container, .ad, [class*="ad-"], 
              .overlay, .popup, .modal,
              [id*="ad"], [id*="Ad"] {
                display: none !important;
              }
            `;
            
            try {
              // 尝试直接注入
              iframe.contentDocument.head.appendChild(style);
              
              // 注入点击事件拦截器
              var clickScript = document.createElement('script');
              clickScript.textContent = `
                // 拦截所有点击事件
                document.addEventListener('click', function(e) {
                  var target = e.target;
                  while(target && target !== document) {
                    if(target.tagName === 'A' && target.href) {
                      if(target.href !== window.location.href) {
                        window.parent.postMessage({
                          type: 'redirect',
                          url: target.href
                        }, '*');
                        e.preventDefault();
                        return;
                      }
                    }
                    target = target.parentNode;
                  }
                }, true);
                
                // 拦截表单提交
                document.addEventListener('submit', function(e) {
                  if(e.target.action) {
                    window.parent.postMessage({
                      type: 'redirect',
                      url: e.target.action
                    }, '*');
                    e.preventDefault();
                  }
                }, true);
                
                // 拦截window.location跳转
                var originalLocation = window.location;
                Object.defineProperty(window, 'location', {
                  get: function() {
                    return originalLocation;
                  },
                  set: function(value) {
                    if(value && value.href) {
                      window.parent.postMessage({
                        type: 'redirect',
                        url: value.href
                      }, '*');
                    } else if(typeof value === 'string') {
                      window.parent.postMessage({
                        type: 'redirect',
                        url: value
                      }, '*');
                    }
                    return originalLocation;
                  }
                });
              `;
              iframe.contentDocument.head.appendChild(clickScript);
            } catch(e) {
              console.log('直接注入失败:', e);
            }
          } catch(e) {
            console.log('样式注入出错:', e);
          }
        };
        
        iframe.src = tureurl;
        document.body.appendChild(iframe);
        console.log(tureurl);
      }
    } else {
      console.log("nourls");
    }
  </script>
</body>
</html>
